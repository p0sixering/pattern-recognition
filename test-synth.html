
<!doctype html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Sympathetic Synthesizer System Mk1</title>
        <meta name="description" content="An analogue synth made with the Web Audio API"/>
        <meta name="author" content="Stuart Memo"/>
        <link rel="stylesheet" media="screen, projection" href="synth.css"/>
        <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    </head>
    <body>
    


        <script src="tsw.js"></script>
        <script src="synth.js"></script>
        <script>
            // Check if browser is capable
            if ((typeof webkitAudioContext === 'undefined') && (typeof AudioContext === 'undefined')) {
                document.querySelectorAll('.synth')[0].insertAdjacentHTML('afterbegin',
                    '<h1>Sorry, your browser doesn\'t support the Web Audio API. ' +
                    'Try <a href="http://google.com/chrome">Chrome</a> instead!</h1>');
            }

            var synth = new Synth({
                    context: tsw.context(),
                    speakersOn: true
                });

            var inputs = document.getElementsByTagName('input'),
                selects = document.getElementsByTagName('select');

            // Turn NodeLists into Arrays
            inputs = Array.prototype.slice.call(inputs);
            selects = Array.prototype.slice.call(selects);

            inputs = inputs.concat(selects);

            var updateSettings = function () {
                var osc = this.getAttribute('data-oscillator'),
                    param = this.getAttribute('data-param');

                switch (param) {
                    case 'range':
                        synth.oscillators[osc][param] = this.value;
                        break;
                    case 'waveform':
                        synth.oscillators[osc][param] = this.value;
                        break;
                    case 'detune':
                        synth.oscillators[osc][param] = this.value;
                        synth.activeOscillators.forEach(function (oscillator) {
                            oscillator.detune.value = synth.oscillators[osc][param];
                        });
                        break;
                    case 'filter':
                        switch (this.name) {
                            case 'filter-attack':
                                synth.filterEnvelopeSettings.attackTime = parseInt(this.value, 10);
                                break;
                            case 'filter-decay':
                                synth.filterEnvelopeSettings.decayTime = parseInt(this.value, 10);
                                break;
                            case 'filter-sustain':
                                synth.filterEnvelopeSettings.sustainLevel = parseInt(this.value, 10);
                                break;
                            case 'filter-release':
                                synth.filterEnvelopeSettings.releaseTime = parseInt(this.value, 10);
                                break;
                            case 'cutoffFrequency':
                                synth.filterEnvelopeSettings.startLevel = parseInt(this.value, 10);
                                break; 
                            case 'emphasis':
                                synth.filterEnvelopeSettings.Q = parseInt(this.value, 10);
                                break;
                            case 'contour':
                                //synth.filter.node.Q.value = parseInt(this.filter.emphasis, 10);
                                break;
                            default:
                                break;
                        };
                        break;
                    case 'volume-filter':
                        synth.volumeEnvelopeSettings[this.name] = parseFloat(this.value, 10);
                        break;
                    case 'mixer':
                        synth.mixer[osc].node.gain.value = this.value;
                        break;
                    case 'lfo':
                        switch (this.name) {
                            case 'lfo-waveType':
                                synth.lfoSettings.node.setWaveType(this.value);
                                break;
                            case 'lfo-frequency':
                                synth.lfoSettings.node.frequency.value = this.value;
                                break;
                            case 'lfo-depth':
                                synth.lfoSettings.node.depth(this.value);
                                break;
                            default:
                                break;
                        };
                    case 'volume':
                        synth.masterVolume.gain(this.value);
                        break;
                    case 'noise':
                        synth.noiseLevel.gain(this.value);
                        break;
                    default:
                        break;
                };
            };
            
            for (var i = 0; i < inputs.length; i++) {
                inputs[i].addEventListener('change', function () {
                    updateSettings.call(this);
                });

                updateSettings.call(inputs[i]);
            }
      
        synth.playNote('C4');
        synth.playNote('E4');
        </script>
    </body>
</html>
