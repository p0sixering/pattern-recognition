<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!-- Synth scripts from Stuart Memo:  http://stuartmemo.com/synth/ -->
<script src="synth/tsw.js"></script>
<script src="synth/synth.js"></script>

<script type="text/javascript" src="raphael-min.js"></script>
<script type="text/javascript" src="shapes.js"></script>
<script type="text/javascript" src="buttons.js"></script>
<script type="text/javascript" src="layouts.js"></script>
<script type="text/javascript" src="mod-functions.js"></script>
</head>

<body>
<script type="text/javascript">

// From http://stackoverflow.com/questions/321113/
function partial(func /*, 0..n args */) {
  var args = Array.prototype.slice.call(arguments, 1);
  return function() {
    var allArguments = args.concat(Array.prototype.slice.call(arguments));
    return func.apply(this, allArguments);
  };
}

// mouse on / off functions:
function betterNoteClick(synth, note) {
    synth.playNote(note);
}

function betterNoteStop(synth, note) {
    synth.stopNote(note);
}

// Global button data
var buttonData = [];
var butttonDifferences = {};


function init() {
    // Creates canvas.
    var screensize = {x: 1024, y:  768}
    var paper = Raphael(0, 0, screensize.x, screensize.y);

    // Let us make 12 large grids - 5x5 to 9x9
    // We are going to IGNORE offset for now, and make all of these orthongonal
    makeColumnGrid(paper, {x:25, y:25}, 5, 5, {x:5, y:5}, 0, '#AA0000', 'circle', {x:10, y:10}, 0, {});
    makeColumnGrid(paper, {x:150, y:25}, 5, 7, {x:10, y:0}, 0, '#123456', 'triangle', {x:15, y:15}, Math.PI / 2, {});
    makeColumnGrid(paper, {x:300, y:25}, 8, 6, {x:10, y:15}, 0, '#FFFF00', 'square', {x:5, y:5}, 0, {});
    makeColumnGrid(paper, {x:225, y:25}, 7, 7, {x:20, y:7}, 0, '#00BB45', 'pentagon', {x:25, y:25}, Math.PI / 5, {});

    makeColumnGrid(paper, {x:20, y:200}, 5, 6, {x:5, y:10}, 0, '#197723', 'hexagon', {x:10, y:10}, 0, {});
    makeColumnGrid(paper, {x:175, y:200}, 9, 9, {x:20, y:0}, 0, '#000000', 'octagon', {x:15, y:15}, Math.PI / 2, {});
    makeColumnGrid(paper, {x:200, y:200}, 8, 7, {x:50, y:5}, 0, '#BBA016', 'rectangle', {x:5, y:15}, 0, {});
    makeColumnGrid(paper, {x:315, y:200}, 7, 9, {x:2, y:27}, 0, '#FFFFFF', 'rectangle', {x:25, y:10}, Math.PI / 5, {});


        makeColumnGrid(paper, {x:55, y:350}, 9, 6, {x:15, y:60}, 0, '#CCCCCC', 'triangle', {x:11, y:19}, 0, {});
    makeColumnGrid(paper, {x:145, y:350}, 9, 8, {x:30, y:30}, 0, '#455453', 'square', {x:15, y:15}, Math.PI / 2, modFunctions);
    makeColumnGrid(paper, {x:275, y:350}, 8, 8, {x:0, y:0}, 0, '#ABCCBA', 'rectangle', {x:25, y:35}, 0, pianoModFunctions);
    makeColumnGrid(paper, {x:385, y:350}, 7, 6, {x:20, y:20}, 0, '#120021', 'circle', {x:7, y:10}, Math.PI / 5, {});

    // Hyper-rough faux mapping
    for (var i = 0; i < buttonData.length; i++) {
        // Create the synth for each button:  this may run me out of processor.
        var synth = new Synth({
            context: tsw.context(),
            speakersOn: true
        });

        // Yes, we can change parameters per synth here
        var freq = buttonData[i].location.x * 2.1828 + buttonData[i].location.y / 1.618;
        
        var pitchString = 'C4';
        if (i % 2 == 0) {
            pitchString = 'D3';
        }

        var mouseDownFunc = partial(betterNoteClick, synth, pitchString);
        var mouseUpFunc = partial(betterNoteStop, synth, pitchString);
        buttonData[i].button.node.addEventListener('mousedown', mouseDownFunc);
        buttonData[i].button.node.addEventListener('mouseup', mouseUpFunc);
    }
}

window.onload = init;
</script>
</body>
</html>